<!DOCTYPE html>
<html>
<head>
    <title>Attack Trajectories Histogram with Frequencies</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div>
        <label for="systemsInput">Number of Systems (M):</label>
        <input type="number" id="systemsInput" placeholder="Enter M" min="1" value="1000">
        <label for="attacksInput">Number of Attacks (N):</label>
        <input type="number" id="attacksInput" placeholder="Enter N" min="1" value="100">
        <label for="probabilityInput">Penetration Probability (p):</label>
        <input type="number" id="probabilityInput" placeholder="Enter p" min="0" max="1" step="0.01" value="0.3">
        <button id="simulateButton">Simulate Trajectories</button>
    </div>
    <div>
        <canvas id="histogram-chart" width="800" height="400"></canvas>
    </div>

    <script>
        function simulateSecurityScores(M, N, p) {
            return new Promise((resolve) => {
                const scores = Array.from({ length: M }, () => Array.from({ length: N }, () => 0));
                for (let i = 0; i < M; i++) {
                    for (let j = 0; j < N; j++) {
                        const score = Math.random() <= p ? -1 : 1;
                        scores[i][j] = score;
                    }
                }
                resolve(scores);
            });
        }

        function calculateAttackTrajectoriesHistogram(scores, N) {
            const histogram = Array(N + 1).fill(0);
            const cumulativeFrequency = Array(N + 1).fill(0);
            for (let i = 0; i < scores.length; i++) {
                let penetrationCount = 0;
                for (let j = 0; j < N; j++) {
                    if (scores[i][j] === -1) {
                        penetrationCount++;
                    }
                    histogram[penetrationCount]++;
                    cumulativeFrequency[penetrationCount]++;
                }
            }
            const relativeFrequency = histogram.map((f) => f / scores.length);
            const normalizedRatio = histogram.map((f) => f / Math.sqrt(N * scores.length));
            return { histogram, cumulativeFrequency, relativeFrequency, normalizedRatio };
        }

        function drawHistogramChart(data, N) {
            const ctx = document.getElementById("histogram-chart").getContext("2d");
            const chart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: Array.from({ length: N + 1 }, (_, i) => `Penetrations: ${i}`),
                    datasets: [
                        {
                            label: "Cumulative Frequency (f)",
                            data: data.cumulativeFrequency,
                            backgroundColor: 'rgba(0, 123, 255, 0.7)',
                            borderColor: 'rgba(0, 123, 255, 1)',
                            borderWidth: 1,
                        },
                        {
                            label: "Relative Frequency (f/N)",
                            data: data.relativeFrequency,
                            backgroundColor: 'rgba(255, 0, 0, 0.7)',
                            borderColor: 'rgba(255, 0, 0, 1)',
                            borderWidth: 1,
                        },
                        {
                            label: "Normalized Ratio (f/âˆš(N*M))",
                            data: data.normalizedRatio,
                            backgroundColor: 'rgba(0, 255, 0, 0.7)',
                            borderColor: 'rgba(0, 255, 0, 1)',
                            borderWidth: 1,
                        },
                    ],
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "Frequency",
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: "Number of Penetrations",
                            },
                        },
                    },
                },
            });
        }

        document.getElementById("simulateButton").addEventListener("click", async () => {
            const M = parseInt(document.getElementById("systemsInput").value);
            const N = parseInt(document.getElementById("attacksInput").value);
            const p = parseFloat(document.getElementById("probabilityInput").value);

            const scores = await simulateSecurityScores(M, N, p);
            const histogramData = calculateAttackTrajectoriesHistogram(scores, N);
            drawHistogramChart(histogramData, N);
        });
    </script>
</body>
</html>
